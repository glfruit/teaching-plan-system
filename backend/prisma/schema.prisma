generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  TEACHER
}

enum TeachingPlanStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum TemplateCategory {
  THEORY
  EXPERIMENT
  PRACTICE
}

enum PlanStatus {
  DRAFT
  ACTIVE
  COMPLETED
  ARCHIVED
}

enum WeekStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  ADJUSTED
}

model User {
  id                String             @id @default(uuid())
  username          String             @unique
  email             String             @unique
  password          String
  role              UserRole           @default(TEACHER)
  department        String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  teachingPlans     TeachingPlan[]
  teachingTemplates TeachingTemplate[]
  semesterPlans     SemesterPlan[]
  courseSchedules   CourseSchedule[]

  @@map("users")
}

model TeachingTemplate {
  id          String           @id @default(uuid())
  name        String
  description String?
  category    TemplateCategory
  structure   Json
  isSystem    Boolean          @default(false)
  creatorId   String
  creator     User             @relation(fields: [creatorId], references: [id])
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@map("teaching_templates")
  @@index([category])
  @@index([creatorId])
}

model TeachingPlan {
  id          String             @id @default(uuid())
  title       String
  courseName  String
  className   String
  duration    Int                @default(45)
  objectives  String             @db.Text
  keyPoints   String             @db.Text
  process     String             @db.Text
  blackboard  String?            @db.Text
  reflection  String?            @db.Text
  methods     String?            @db.Text
  resources   String?            @db.Text
  htmlContent String             @db.Text
  status      TeachingPlanStatus @default(DRAFT)
  teacherId   String
  teacher     User               @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  weeklyPlans WeeklyPlan[]

  @@map("teaching_plans")
}

model SemesterPlan {
  id          String       @id @default(uuid())
  teacherId   String
  teacher     User         @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  courseName  String
  semester    String       // e.g., 2025-2026-1
  startDate   DateTime?    // Optional for now, but good to have
  totalWeeks  Int
  weeklyHours Int
  description String?
  status      PlanStatus   @default(DRAFT)
  weeklyPlans WeeklyPlan[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@map("semester_plans")
}

model WeeklyPlan {
  id             String        @id @default(uuid())
  semesterPlanId String
  semesterPlan   SemesterPlan  @relation(fields: [semesterPlanId], references: [id], onDelete: Cascade)
  weekNumber     Int
  startDate      DateTime
  endDate        DateTime
  plannedContent String        // Plan content
  actualContent  String?       // Actual content
  status         WeekStatus    @default(PLANNED)
  teachingPlanId String?
  teachingPlan   TeachingPlan? @relation(fields: [teachingPlanId], references: [id])
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("weekly_plans")
}

model CourseSchedule {
  id         String   @id @default(uuid())
  teacherId  String
  teacher    User     @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  className  String
  courseName String
  dayOfWeek  Int      // 1-7
  period     Int      // Period number
  classroom  String?
  semester   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("course_schedules")
}
