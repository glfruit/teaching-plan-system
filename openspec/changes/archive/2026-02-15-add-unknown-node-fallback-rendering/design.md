## Context

当前教案编辑器已具备已知教学块与富文本的保存重开能力，但对未知节点的兼容仍偏“降级文本化”，存在结构语义丢失风险。随着节点体系持续演进（版本差异、灰度发布、历史数据），系统需要一种前向兼容策略：既不阻断教师编辑，也不丢失未知节点原始信息。

## Goals / Non-Goals

**Goals:**
- 未知节点以可见“只读占位块”渲染，避免静默丢失。
- 占位块保留原始未知节点 payload（type/attrs/content）以支持 round-trip。
- 教师可删除占位块，避免文档被未知数据“锁死”。
- 保存-重开链路稳定，不因未知节点导致崩溃。

**Non-Goals:**
- 本次不实现未知节点可编辑能力。
- 不引入后端 API 或数据库 schema 变更。
- 不做全量 HTML/JSON 双向语义转换重构。

## Decisions

1. 在前端引入未知节点占位表示层（readonly）
- 原因：保证教师可感知未知内容且不误编辑。
- 备选：直接文本降级；放弃，因为会丢失结构语义和回放能力。

2. 占位数据中保存原始 payload，提交时可回写
- 原因：满足兼容升级时的可恢复性。
- 备选：仅保存节点类型；放弃，因为 attrs/content 会丢失。

3. 删除策略采用“显式允许删除”
- 原因：提升可操作性，避免编辑阻塞。
- 备选：禁止删除；放弃，因为会造成坏数据长期滞留。

4. 影响面控制在 store + editor node/renderer + tests
- 原因：减少改动半径，维持现有 API 兼容。

## Risks / Trade-offs

- [Risk] 占位结构与真实节点渲染存在差异 → Mitigation: 明确标注“未知节点（只读）”，避免误解。
- [Risk] 回写链路处理不当导致 payload 丢失 → Mitigation: 增加保存-重开 round-trip 测试。
- [Risk] 删除操作误删用户需要保留的数据 → Mitigation: 保持删除操作显式触发，并复用现有撤销能力。

## Migration Plan

1. 先加测试：未知节点解析、占位渲染、删除、重开。
2. 实现占位节点与序列化桥接。
3. 接入保存 payload 组装路径，验证 round-trip。
4. 跑前端全量测试；通过后合并。
5. 如需回滚，移除占位节点接入并保留原降级策略。

## Open Questions

- 占位块 UI 文案是否需要显示“来源版本/节点类型详情”（可后续迭代）。
- 是否在导出链路中保留未知节点占位文本（本次暂不改导出）。
